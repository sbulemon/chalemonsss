<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSINT Lookup with Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-search"></i> OSINT BY @sbulemon</h1>
        
        <div class="button-group">
            <h2>Трекер</h2>
            <button id="createTrackerBtn"><i class="fas fa-eye"></i> Создать трекер</button>
            <button id="viewLogsBtn"><i class="fas fa-file-alt"></i> Логи трекера</button>
        </div>

        <div id="trackerSection" class="section hidden">
            <div class="input-group">
                <i class="fas fa-eye"></i>
                <button id="generateLinkBtn">Сгенерировать ссылку</button>
            </div>
            <div id="trackerResult" class="result-card"></div>
        </div>

        <div id="logsSection" class="section hidden">
            <div class="input-group">
                <i class="fas fa-search"></i>
                <input type="text" id="logFilter" placeholder="Поиск по логам...">
                <button id="clearLogsBtn">Очистить логи</button>
                <button id="exportLogsBtn">Экспорт логов (JSON)</button>
            </div>
            <div id="trackerLogOutput" class="result-card"></div>
        </div>
        
        <footer>
            <a href="https://t.me/lemon_tool" target="_blank"><i class="fab fa-telegram"></i></a>
        </footer>
    </div>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0d1117;
            color: #ffffff;
            padding: 20px;
            margin: 0;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #1e252d;
            border-radius: 10px;
        }

        h1 {
            font-size: 2em;
            text-align: center;
            color: #33ff33;
            margin-bottom: 20px;
        }

        .button-group {
            margin-bottom: 20px;
        }

        .button-group h2 {
            color: #33ff33;
            font-size: 1.2em;
            margin: 10px 0;
        }

        .button-group button {
            padding: 10px 15px;
            background: #33ff33;
            border: none;
            border-radius: 5px;
            color: #000;
            cursor: pointer;
            margin: 5px;
        }

        .section {
            margin: 20px 0;
            padding: 15px;
            background: #252c36;
            border-radius: 5px;
        }

        .hidden {
            display: none;
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #2e3642;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #33ff33;
        }

        .input-group i {
            padding: 10px;
            color: #33ff33;
        }

        .input-group input {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            color: #fff;
            outline: none;
        }

        .input-group button {
            padding: 10px 15px;
            background: #33ff33;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            color: #000;
        }

        .result-card {
            padding: 15px;
            background: #1e252d;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
        }

        .result-card strong {
            color: #33ff33;
        }

        footer {
            margin-top: 20px;
            text-align: center;
        }

        footer a {
            color: #33ff33;
            font-size: 1.5em;
        }
    </style>

    <script>
        window.onload = function() {
            console.log('Страница полностью загружена');

            let trackerLogs = JSON.parse(localStorage.getItem('trackerLogs')) || [];

            // Элементы DOM
            const createTrackerBtn = document.getElementById('createTrackerBtn');
            const viewLogsBtn = document.getElementById('viewLogsBtn');
            const generateLinkBtn = document.getElementById('generateLinkBtn');
            const clearLogsBtn = document.getElementById('clearLogsBtn');
            const exportLogsBtn = document.getElementById('exportLogsBtn');
            const logFilter = document.getElementById('logFilter');
            const trackerSection = document.getElementById('trackerSection');
            const logsSection = document.getElementById('logsSection');
            const trackerResult = document.getElementById('trackerResult');
            const trackerLogOutput = document.getElementById('trackerLogOutput');

            // Проверка элементов
            if (!createTrackerBtn || !viewLogsBtn || !generateLinkBtn || !clearLogsBtn || !exportLogsBtn || !trackerSection || !logsSection || !trackerResult || !trackerLogOutput) {
                console.error('Ошибка: один или несколько элементов DOM не найдены');
                alert('Ошибка загрузки страницы. Проверьте консоль.');
                return;
            }

            // Функции
            function toggleSection(sectionToShow) {
                console.log('Тоггл секции:', sectionToShow);
                if (sectionToShow === 'tracker') {
                    trackerSection.classList.remove('hidden');
                    logsSection.classList.add('hidden');
                } else if (sectionToShow === 'logs') {
                    logsSection.classList.remove('hidden');
                    trackerSection.classList.add('hidden');
                }
            }

            function generateTrackerLink() {
                console.log('Генерация ссылки');
                const trackerId = Math.random().toString(36).substring(2, 15);
                const currentUrl = window.location.href.split('?')[0];
                const trackerUrl = `${currentUrl}?tracker=${trackerId}`;
                trackerResult.innerHTML = `
                    <p><strong>Ваша ссылка:</strong> <a href="${trackerUrl}" target="_blank">${trackerUrl}</a></p>
                    <p>Отправьте эту ссылку для сбора данных.</p>
                `;
                alert('Ссылка сгенерирована: ' + trackerUrl);
            }

            function updateTrackerLogDisplay(logs = trackerLogs) {
                console.log('Обновление логов:', logs);
                trackerLogOutput.innerHTML = '';
                logs.forEach(log => {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <p><strong>ID:</strong> ${log.trackerId}</p>
                        <p><strong>Время:</strong> ${log.timestamp}</p>
                        <p><strong>IP:</strong> ${log.ip}</p>
                        <p><strong>Страна:</strong> ${log.country}</p>
                        <p><strong>Город:</strong> ${log.city}</p>
                        <p><strong>ISP:</strong> ${log.isp}</p>
                        <p><strong>User-Agent:</strong> ${log.userAgent}</p>
                    `;
                    trackerLogOutput.appendChild(div);
                });
            }

            function filterLogs() {
                console.log('Фильтрация логов');
                const filter = logFilter.value.toLowerCase();
                const filteredLogs = trackerLogs.filter(log => 
                    log.trackerId.toLowerCase().includes(filter) ||
                    log.ip.toLowerCase().includes(filter) ||
                    log.country.toLowerCase().includes(filter) ||
                    log.city.toLowerCase().includes(filter) ||
                    log.isp.toLowerCase().includes(filter) ||
                    log.userAgent.toLowerCase().includes(filter)
                );
                updateTrackerLogDisplay(filteredLogs);
            }

            function clearTrackerLogs() {
                console.log('Очистка логов');
                trackerLogs = [];
                localStorage.removeItem('trackerLogs');
                updateTrackerLogDisplay();
                alert('Логи очищены!');
            }

            function exportLogs() {
                console.log('Экспорт логов');
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(trackerLogs, null, 2));
                const downloadAnchor = document.createElement('a');
                downloadAnchor.setAttribute("href", dataStr);
                downloadAnchor.setAttribute("download", "tracker_logs.json");
                document.body.appendChild(downloadAnchor);
                downloadAnchor.click();
                downloadAnchor.remove();
                alert('Логи экспортированы!');
            }

            async function logVisitor() {
                const urlParams = new URLSearchParams(window.location.search);
                const trackerId = urlParams.get('tracker');

                if (!trackerId) {
                    console.log('Нет trackerId, отображаем интерфейс');
                    updateTrackerLogDisplay();
                    return;
                }

                console.log('Логирование посетителя с ID:', trackerId);
                const timestamp = new Date().toLocaleString();
                const userAgent = navigator.userAgent;

                let ipData = {};
                try {
                    console.log('Запрос к ip-api');
                    const response = await fetch('https://ip-api.com/json/?fields=query,country,city,isp', {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP ошибка: ${response.status}`);
                    }
                    ipData = await response.json();
                    console.log('Успешно получены данные от ip-api:', ipData);
                } catch (error) {
                    console.error('Ошибка при запросе к ip-api:', error);
                    ipData = {
                        query: 'Неизвестно',
                        country: 'Неизвестно',
                        city: 'Неизвестно',
                        isp: 'Неизвестно'
                    };
                }

                const logEntry = {
                    trackerId,
                    timestamp,
                    ip: ipData.query || 'Неизвестно',
                    country: ipData.country || 'Неизвестно',
                    city: ipData.city || 'Неизвестно',
                    isp: ipData.isp || 'Неизвестно',
                    userAgent
                };

                trackerLogs.push(logEntry);
                localStorage.setItem('trackerLogs', JSON.stringify(trackerLogs));
                console.log('Запись добавлена в логи:', logEntry);

                document.body.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #fff;">
                        <h1>Спасибо за посещение!</h1>
                        <p>Ваши данные записаны.</p>
                        <a href="${window.location.href.split('?')[0]}" style="color: #33ff33;">Вернуться</a>
                    </div>
                `;
            }

            // Привязка событий
            createTrackerBtn.onclick = () => {
                console.log('Клик: Создать трекер');
                toggleSection('tracker');
            };
            viewLogsBtn.onclick = () => {
                console.log('Клик: Логи трекера');
                toggleSection('logs');
            };
            generateLinkBtn.onclick = () => {
                console.log('Клик: Сгенерировать ссылку');
                generateTrackerLink();
            };
            clearLogsBtn.onclick = () => {
                console.log('Клик: Очистить логи');
                clearTrackerLogs();
            };
            exportLogsBtn.onclick = () => {
                console.log('Клик: Экспорт логов');
                exportLogs();
            };
            logFilter.onkeyup = () => {
                console.log('Ввод в фильтр');
                filterLogs();
            };

            // Инициализация
            console.log('Запуск инициализации');
            logVisitor();
        };
    </script>
</body>
</html>
